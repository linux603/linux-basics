
# ðŸŸ¦ 1. LOGGING SYSTEM OVERVIEW (Linux Admin Basics)

Linux logs are generated by:

###  systemd-journald service 

Collects logs from:

 Kernel
 System services
 Initramfs 
 Userspace apps (via syslog API)
 stdout/stderr of services

 
And Stores logs in binary format at:
/run/log/journal/     (volatile = temperaory)
/var/log/journal/     (persistent = permanat)

Provides logs using command:

journalctl

note : It is part of systemd, so it starts automatically.


###  rsyslog (traditional text logs)

Takes logs from systemd-journald

Writes logs to text files in /var/log/

rsyslog Supports:

Log forwarding to remote servers

Syslog protocol (RFC 3164/5424)

Log filtering

Log rotation via logrotate


These are written by rsyslog, not journald.

note : rsyslog and systemd-journald are logging services (daemons) in Linux, but they play different roles.
====

finally How They Work Together (Flow) ???? 
-----------------------------------------

Default log flow (modern Linux):

Applications â†’ systemd-journald â†’ rsyslog â†’ /var/log/.log

journald collects everything

rsyslog reads journald logs

rsyslog writes traditional text logs

note :
Many apps also write logs directly:

 Apache â†’ /var/log/httpd/ or /var/log/apache2/
 Nginx â†’ /var/log/nginx/
 MySQL â†’ /var/log/mysqld.log
 SSH â†’ /var/log/secure or /var/log/auth.log


How to check if they are running ???? 
-------------------------------------
systemd-journald:
systemctl status systemd-journald

rsyslog:
systemctl status rsyslog

---
# ðŸŸ© 2. IMPORTANT LOG FILES (BY PATH)

### System Logs

| File                | Description                         |
| ------------------- | ----------------------------------- |
| /var/log/messages | General system logs (RHEL)          |
| /var/log/syslog   | General system logs (Ubuntu/Debian) |
| /var/log/dmesg    | Kernel ring buffer logs             |

### Security Logs

| File                | Description                             |
| ------------------- | --------------------------------------- |
| /var/log/secure   | Authentication & security events (RHEL) |
| /var/log/auth.log | Authentication logs (Ubuntu/Debian)     |

### Boot Logs

| File                | Description                    |
| ------------------- | ------------------------------ |
| /var/log/boot.log | Boot information from services |

### Service-specific Logs

| Service   | Log Path                                   |
| --------- | ------------------------------------------ |
| SSH       | /var/log/secure or /var/log/auth.log   |
| Cron      | /var/log/cron or /var/log/syslog       |
| Apache    | /var/log/httpd/ or /var/log/apache2/   |
| Nginx     | /var/log/nginx/                          |
| MySQL     | /var/log/mysqld.log or /var/log/mysql/ |
| Firewalld | /var/log/firewalld (if enabled)          |




# ðŸŸ¦ 3. LOG COMMANDS (ALL OPTIONS EXPLAINED)

 A) journalctl â€“ View systemd journal logs

### Basic Usage

| Command                   | Explanation            |
| ------------------------- | ---------------------- |
| journalctl              | Show all logs          |
| journalctl -b           | Logs from current boot |   
| journalctl -b -1        | Previous boot logs     |
| journalctl --list-boots | List boots with IDs    |

---

### Filter by time

| Command                                                | Explanation |
| ------------------------------------------------------ | ----------- |
| journalctl --since "1 hour ago"                      | Last 1 hour |
| journalctl --since today                             | Since today |
| journalctl --since "2025-01-01" --until "2025-01-10" | Time range  |

---

### Follow logs (like tail -f)


journalctl -f


---

### View logs for a specific service


journalctl -u sshd
journalctl -u firewalld
journalctl -u nginx


More options:

| Option            | Meaning                       |
| ----------------- | ----------------------------- |
| -u NAME.service | Filter by systemd service     |
| -r              | Reverse order (newest first)  |
| -k              | Kernel logs only              |
| -xe             | Show errors with explanations |

---

### Persistent journald

Make logs persistent:

Persistent journald means that systemd-journald stores logs permanently on disk, instead of keeping them only in memory


## journald has two modes :

âœ” 1. Volatile (default on some distros)

Logs stored in RAM

Location:

/run/log/journal/

Logs are lost after reboot âŒ

âœ” 2. Persistent (recommended for servers)

Logs stored on disk

Location:

/var/log/journal/

Logs survive reboot âœ”


âœ” 3. How to enable persistent journald

Create the directory:
sudo mkdir -p /var/log/journal

Restore correct permissions:
sudo systemd-tmpfiles --create --prefix /var/log/journal

Restart journald:
sudo systemctl restart systemd-journald

Now journald will automatically write logs to:

/var/log/journal/


 B) dmesg â€“ Kernel logs

### Basic


dmesg


### Follow kernel logs


dmesg -w


### Time-stamped output


dmesg -T


### Filter

| Usage         | Example              |
| ------------- | -------------------- |
| Only errors   | dmesg --level=err  |
| Only warnings | dmesg --level=warn |
| Only info     | dmesg --level=info |

---

 C) tail / less / grep â€“ Read traditional text logs

### View last 100 lines


tail -n 100 /var/log/messages


### Follow log file


tail -f /var/log/messages


### Search inside logs


grep "error" /var/log/messages
grep -i "fail" /var/log/secure


### View logs page-by-page


less /var/log/messages


---

D) rsyslog Configuration

Main config file:


/etc/rsyslog.conf


Directory:


/etc/rsyslog.d/


Restart:

systemctl restart rsyslog


---

# ðŸŸ¦ 4. LOG ROTATION â€” logrotate

What is Log Rotation?

Log rotation means:

When a log file (like /var/log/messages) gets too largeâ€¦

It is renamed, compressed, archived, or deleted

A new fresh log file is created for future logs

ex :
/var/log/messages        â†’ current log
/var/log/messages.1      â†’ yesterday's log
/var/log/messages.2.gz   â†’ older compressed log

Why Log Rotation is Needed?

âœ”ï¸ Prevents logs from filling the disk
If logs grow without limit â†’
System will crash, services fail, no disk space.

âœ”ï¸ Keeps logs manageable
Old logs are compressed:
messages.3.gz is much smaller than plain logs.

âœ”ï¸ Improves performance
Small log files are faster to read and write.

âœ”ï¸ Keeps logs organized
Old logs kept by date or count.

âœ”ï¸ Security + auditing
Keeps historical logs for investigations.


## Who performs log rotation? 

The system tool:
logrotate

Runs automatically via cron jobs :
/etc/cron.daily/logrotate
So every day, cron runs logrotate â†’ logrotate checks logs â†’ rotates if needed.

## Where is logrotate configured?
a.Global config:
/etc/logrotate.conf
This file contains:
global rules
include directory /etc/logrotate.d

b.Per-application/service configuration
/etc/logrotate.d/

Examples inside this folder:

/etc/logrotate.d/httpd
/etc/logrotate.d/rsyslog
/etc/logrotate.d/cron
/etc/logrotate.d/yum

Each application has its own rotation rules.

## Important logrotate options (with explanation) 

âœ” time-based rotation
daily     â†’ rotate once per day
weekly    â†’ rotate once per week
monthly   â†’ rotate once per month

âœ” size-based rotation
size 50M   â†’ rotate when file is 50 MB or more

âœ” how many rotated files to keep 
rotate 7   â†’ keep last 7 rotated logs

âœ” compress old logs
compress   â†’ compress rotated logs with .gz

âœ” run a command after rotation
--
postrotate
    systemctl reload rsyslog
endscript
--
Used to restart or reload services after rotation.

âœ” create a new log file
create 0640 root adm

After rotating, create a new log file with:
permissions â†’ 0640
owner â†’ root
group â†’ adm


## Example logrotate config for /var/log/messages

/var/log/messages {
    weekly
    rotate 4
    size 10M
    compress
    notifempty
    create 0600 root root
    postrotate
        systemctl reload rsyslog
    endscript
}

Logrotate performs:

Rotate when file >10M or weekly

Rename to messages.1

Compress older logs

create new log file with correct permission

postrotate reload rsyslog

rsyslog starts writing to new file

## Manual rotation (force)
logrotate -f /etc/logrotate.conf

How rotation looks in file system
/var/log/messages
/var/log/messages.1
/var/log/messages.2.gz
/var/log/messages.3.gz

#############
#############

# What is Manual Log Rotation?

### Definition:

You rotate the logs yourself, using commandsâ€”no automation.

### How itâ€™s done?

Using:

```
logrotate -f /etc/logrotate.conf
```

or rotating a specific file:

```
logrotate -f /etc/logrotate.d/httpd
```

### What happens?

 You force rotation immediately
 Logs get renamed (`file â†’ file.1`)
 New file is created
 Postrotate commands run

### Used when?

 Disk is full suddenly
 Logs growing unexpectedly
 During troubleshooting
 Testing logrotate configs

### Example situation:

Your `/var/log/messages` is suddenly increated 5GB â†’ manually rotate.

---

#  What is Automatic Log Rotation?

### Definition:

Log rotation happens automatically at scheduled times using cron or systemd timers.

### Who performs it?

âœ”ï¸ Daily by cron:

```
/etc/cron.daily/logrotate
```

âœ”ï¸ Or by systemd timer (in newer systems):

```
systemctl status logrotate.timer
```

### How it works?

 Cron/systemd triggers logrotate every day
 It reads:

   `/etc/logrotate.conf` (global settings)
   `/etc/logrotate.d/` (per-service settings)
 Rotates logs based on:

   size
   daily/weekly/monthly
   retention (rotate 4)
   compression
   permission rules

### Used when?

 Regular scheduled rotation
 Ensures logs donâ€™t fill disk
 Keeps logs tidy without human involvement



| Feature                       | Manual Log Rotation          | Automatic Log Rotation         |
| ----------------------------- | -------------------------------- | ---------------------------------- |
| Who triggers it?          | Admin runs command               | System runs via cron/timer         |
| Command required?         | Yes (`logrotate -f`)             | No                                 |
| When does it execute?     | Only when you run it             | Daily/weekly/monthly automatically |
| Based on rules in config? | Yes                              | Yes                                |
| Good for?                 | Urgent cases, testing            | Regular maintenance                |
| Human effort?             | Required                         | Zero                               |
| Risk                      | Forgetting to rotate â†’ disk full | Very low                           |

---

#  Simple Example to Understand

### Automatic Rotation:

Every day at 3 AM, system runs:

```
logrotate /etc/logrotate.conf
```

It checks conditions:

 Is log size > 10M?
 Is today "weekly" rotation day?

If yes â†’ rotation happens.

---

### Manual Rotation:

Admin runs:

```
logrotate -f /etc/logrotate.conf
```

This ignores conditions and rotates RIGHT NOW.


###  How to configure automatic log rotation

You configure it by writing rules in either:

âœ” /etc/logrotate.conf (global)
âœ” /etc/logrotate.d/<service-name> (service-specific)

### Example 1: Automatic rotation for /var/log/messages

Create a config file:

vi /etc/logrotate.d/messages

Add:

/var/log/messages {
    weekly
    rotate 4
    size 10M
    compress
    notifempty
    create 0600 root root
    postrotate
        systemctl reload rsyslog
    endscript
}

Meaning:

weekly â†’ rotate every week

size 10M â†’ OR if file grows above 10MB

rotate 4 â†’ keep 4 old logs

compress â†’ compress old logs with gzip

notifempty â†’ skip rotation if file is empty

create 0600 root root â†’ create new file with permissions

postrotate ... endscript â†’ reload rsyslog after rotation

### Example 2: Automatic rotation for Apache logs

File:

/etc/logrotate.d/httpd


Content:

/var/log/httpd/*log {
    daily
    rotate 7
    missingok
    compress
    delaycompress
    notifempty
    sharedscripts
    postrotate
        /bin/systemctl reload httpd.service > /dev/null 2>/dev/null || true
    endscript
}

## Example 3: Global settings

Edit:

/etc/logrotate.conf


Example:

weekly
rotate 4
create
compress

include /etc/logrotate.d

Meaning:

Apply weekly rotation by default

Keep 4 archives

Compress old logs

Include service-level configs

###  How to verify automatic rotation is working

Check last rotation logs:
cat /var/lib/logrotate/logrotate.status

Check systemd timer (if used):
systemctl status logrotate.timer

Check cron log (if cron is used):
grep logrotate /var/log/cron

## How to test your configuration

Run in dry-run mode:

logrotate -d /etc/logrotate.conf

â†’ Shows what would happen but doesnâ€™t rotate.

############
############




Usage: LOGS FOR TROUBLESHOOTING (Examples)

### Check SSH failures


grep "Failed password" /var/log/secure


### Check sudo logs


grep "sudo" /var/log/secure


### Check system crash messages


journalctl -k -p err


### Check network issues


journalctl -u NetworkManager


### Check boot failures


journalctl -b -p 0..3



#### PRIORITY LEVELS for logs (Logging Severity)

| Level      | Value | Meaning                 |
| ---------- | ----- | ----------------------- |
| emerg  | 0     | System unusable         |
| alert  | 1     | Immediate action needed |
| crit   | 2     | Critical                |
| err    | 3     | Error                   |
| warn   | 4     | Warning                 |
| notice | 5     | Normal but important    |
| info   | 6     | Informational           |
| debug  | 7     | Debug                   |

